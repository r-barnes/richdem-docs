

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Depression-Filling &mdash; RichDEM 0.0.03 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="RichDEM 0.0.03 documentation" href="index.html"/>
        <link rel="next" title="Flow Metrics" href="flow_metrics.html"/>
        <link rel="prev" title="Loading Data" href="loading_data.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> RichDEM
          

          
          </a>

          
            
            
              <div class="version">
                0.0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">RichDEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">Design Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="parsable_output.html">Parsable Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citing RichDEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_it.html">Ways To Use It</a></li>
</ul>
<p class="caption"><span class="caption-text">Operations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dems.html">Example DEMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="loading_data.html">Loading Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Depression-Filling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#depressions-pits-and-sinks">Depressions, Pits, and Sinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#original-dem">Original DEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-filling">Complete Filling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#epsilon-filling">Epsilon Filling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flow_metrics.html">Flow Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow_metrics.html#side-by-side-comparisons-of-flow-metrics">Side-by-Side Comparisons of Flow Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow_accumulation.html">Flow Accumulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="terrain_attributes.html">Terrain Attributes</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples_python.html">Python Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_api.html">RichDEM C++ Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api.html">RichDEM Python Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Testing and Correctness</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="testcorrect.html">Testing Methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="testcorrect.html#correctness">Correctness</a></li>
</ul>
<p class="caption"><span class="caption-text">Extra Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Specific Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html#publications">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="sponsors.html">Sponsors</a></li>
<li class="toctree-l1"><a class="reference internal" href="feedback.html">Feedback</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RichDEM</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Depression-Filling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/depression_filling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="depression-filling">
<h1>Depression-Filling<a class="headerlink" href="#depression-filling" title="Permalink to this headline">¶</a></h1>
<p>Depressions, otherwise known as pits, are areas of a landscape wherein flow
ultimately terminates without reaching an ocean or the edge of a digital
elevation model.</p>
<div class="section" id="depressions-pits-and-sinks">
<h2>Depressions, Pits, and Sinks<a class="headerlink" href="#depressions-pits-and-sinks" title="Permalink to this headline">¶</a></h2>
<p>Depressions have been called by a variety of names. To clarify this mess,
Lindsay (2016) provides a typology. This typology is followed here.</p>
<img alt="_images/Lindsay2016_depression_typology.png" src="_images/Lindsay2016_depression_typology.png" />
</div>
<div class="section" id="original-dem">
<h2>Original DEM<a class="headerlink" href="#original-dem" title="Permalink to this headline">¶</a></h2>
<p>For reference, the original DEM appears as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">richdem</span> <span class="kn">as</span> <span class="nn">rd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">beau</span>    <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;imgs/beauford.npz&#39;</span><span class="p">)[</span><span class="s1">&#39;beauford&#39;</span><span class="p">],</span> <span class="n">no_data</span><span class="o">=-</span><span class="mi">9999</span><span class="p">)</span>
<span class="n">beaufig</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">beau</span><span class="p">,</span> <span class="n">ignore_colours</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//depression_filling-1.py">Source code</a>, <a class="reference external" href=".//depression_filling-1.png">png</a>, <a class="reference external" href=".//depression_filling-1.hires.png">hires.png</a>, <a class="reference external" href=".//depression_filling-1.pdf">pdf</a>)</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/depression_filling-1.png"><img alt="_images/depression_filling-1.png" src="_images/depression_filling-1.png" style="width: 800pt;" /></a>
</div>
</div>
<div class="section" id="complete-filling">
<h2>Complete Filling<a class="headerlink" href="#complete-filling" title="Permalink to this headline">¶</a></h2>
<p>Depression-filling is often used to fill in all the depressions in a DEM to the
level of their lowest outlet or spill-point.</p>
<p>The result looks as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">beau_filled</span>    <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">FillDepressions</span><span class="p">(</span><span class="n">beau</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">beaufig_filled</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">beau_filled</span><span class="p">,</span> <span class="n">ignore_colours</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">beaufig</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">beaufig</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//depression_filling-2.py">Source code</a>, <a class="reference external" href=".//depression_filling-2.png">png</a>, <a class="reference external" href=".//depression_filling-2.hires.png">hires.png</a>, <a class="reference external" href=".//depression_filling-2.pdf">pdf</a>)</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/depression_filling-2.png"><img alt="_images/depression_filling-2.png" src="_images/depression_filling-2.png" style="width: 800pt;" /></a>
</div>
<p>We can visualize the difference between the two like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">beau_diff</span>    <span class="o">=</span> <span class="n">beau_filled</span> <span class="o">-</span> <span class="n">beau</span>
<span class="n">beaufig_diff</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">beau_diff</span><span class="p">,</span> <span class="n">ignore_colours</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//depression_filling-3.py">Source code</a>, <a class="reference external" href=".//depression_filling-3.png">png</a>, <a class="reference external" href=".//depression_filling-3.hires.png">hires.png</a>, <a class="reference external" href=".//depression_filling-3.pdf">pdf</a>)</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/depression_filling-3.png"><img alt="_images/depression_filling-3.png" src="_images/depression_filling-3.png" style="width: 800pt;" /></a>
</div>
<p>Complete Filling is available via the following commands:</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Language</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Python</td>
<td><code class="xref cpp cpp-any docutils literal"><span class="pre">richdem.FillDepressions</span></code></td>
</tr>
<tr class="row-odd"><td>C++</td>
<td><code class="xref cpp cpp-any docutils literal"><span class="pre">richdem::FillDepression</span></code></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Pros</td>
<td>Cons</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li><em>Fast</em></li>
<li>Simple</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Leaves flat regions behind</li>
<li>May modify large portions of a DEM</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="epsilon-filling">
<h2>Epsilon Filling<a class="headerlink" href="#epsilon-filling" title="Permalink to this headline">¶</a></h2>
<p>A downside of complete filling is that it replaces depressions with a perfectly
flat region with no local gradients. One way to deal with this is to ensure that
every cell in the region is raised some small amount, ε, above cells which are
closer to a depression’s spill point.</p>
<p>This must be done carefully. In floating-point DEMs, the value ε is non-constant
and must be chosen using the <code class="xref cpp cpp-any docutils literal"><span class="pre">std::nextafter</span></code> function. If a depression is too
large, the imposed gradient may result in the interior of the depression being
raised above the surrounding landscape. Using <code class="xref cpp cpp-any docutils literal"><span class="pre">double</span></code> instead of <code class="xref cpp cpp-any docutils literal"><span class="pre">float</span></code>
reduces the potential for problems at a cost of twice the space used. If a
problem does arise, RichDEM provides a warning.</p>
<p>We can visualize the difference between the epsilon-filled DEM and the original
DEM like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">beau_epsilon</span>         <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">FillDepressions</span><span class="p">(</span><span class="n">beau</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">beau_eps_diff</span>        <span class="o">=</span> <span class="n">beau_epsilon</span> <span class="o">-</span> <span class="n">beau</span>
<span class="n">beaufig_eps_diff</span>     <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">beau_eps_diff</span><span class="p">,</span> <span class="n">ignore_colours</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//depression_filling-4.py">Source code</a>, <a class="reference external" href=".//depression_filling-4.png">png</a>, <a class="reference external" href=".//depression_filling-4.hires.png">hires.png</a>, <a class="reference external" href=".//depression_filling-4.pdf">pdf</a>)</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/depression_filling-4.png"><img alt="_images/depression_filling-4.png" src="_images/depression_filling-4.png" style="width: 800pt;" /></a>
</div>
<p>We can visualize the difference between the epsilon-filled DEM and the
completely-filled DEM as follows. Note that elevation increases with distance
from the depression’s outlet: this is the effect of the epsilon.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">beau_diffeps_diff</span>    <span class="o">=</span> <span class="n">beau_epsilon</span> <span class="o">-</span> <span class="n">beau_filled</span>
<span class="n">beaufig_diffeps_diff</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdShow</span><span class="p">(</span><span class="n">beau_diffeps_diff</span><span class="p">,</span> <span class="n">ignore_colours</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//depression_filling-5.py">Source code</a>, <a class="reference external" href=".//depression_filling-5.png">png</a>, <a class="reference external" href=".//depression_filling-5.hires.png">hires.png</a>, <a class="reference external" href=".//depression_filling-5.pdf">pdf</a>)</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/depression_filling-5.png"><img alt="_images/depression_filling-5.png" src="_images/depression_filling-5.png" style="width: 800pt;" /></a>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Language</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Python</td>
<td><code class="xref cpp cpp-any docutils literal"><span class="pre">richdem.FillDepressions</span></code></td>
</tr>
<tr class="row-odd"><td>C++</td>
<td><a class="reference internal" href="cpp_api.html#_CPPv2N7richdem22FillDepressionsEpsilonER7Array2DI1TE" title="richdem::FillDepressionsEpsilon"><code class="xref cpp cpp-any docutils literal"><span class="pre">richdem::FillDepressionsEpsilon()</span></code></a></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Pros</td>
<td>Cons</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li>All cells drain</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Not as fast as simple depression filling</li>
<li>May modify large portions of a DEM</li>
<li>May create elevated regions</li>
<li>Success may depend on data type</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="flow_metrics.html" class="btn btn-neutral float-right" title="Flow Metrics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="loading_data.html" class="btn btn-neutral" title="Loading Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Richard Barnes.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.03',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>